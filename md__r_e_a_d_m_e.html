<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>exproblab_ass1: Experimental Robotics Laboratory assignment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">exproblab_ass1
   </div>
   <div id="projectbrief">Lorenzo Causa, 4519089</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Experimental Robotics Laboratory assignment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This is a ROS package that simulates a simple Cluedo-like investigation. It uses ARMOR as reasoner and container of the ontology of the game and smach for the Finite State Machine behavior.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Software Architecture</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Component Diagram</h2>
<p>In the diagram below you can see all the nodes necessary for the correct functioning of the code. smach_viewer is not there as it is only useful for displaying the states while the code is running (so it is not necessary but optional).</p>
<ul>
<li><b><a class="el" href="namespaceupdate__ontology.html">update_ontology</a></b>: This node loads the "cluedo_ontology" into "armor" and adds all cluedo hints. This is done only once for the beginning of everything to decrease the number of REASON that armor has to do, in fact every time an individual is added it is necessary to reason twice: ADD, REASON, DISJOINT and REASON again. It also loads possible hint sources into rosparam: PERSON, WEAPON and PLACE. This node must be run after "armor" after it is completed "oracle" and "FSM" can be run.</li>
<li><b>armor_service</b>: This is the node provided to us to manage ontologies. It is a powerful and versatile management system for single and multi-ontology architectures under ROS. It allows to load, query, and modify multiple ontologies. Despite its ease of use, ARMOR provides a large share of OWL APIs functions and capabilities in a simple server-client architecture and offers increased flexibility compared to previous ontological systems running under ROS.</li>
<li><b>oracle</b>: This node is the oracle of the game, it generates a finite number of hypotheses and provides two services to interact with them:<ul>
<li>hint_generator: It request a hint of an hypothesis.</li>
<li>try_hypothesis: Check if my guess is correct.</li>
</ul>
</li>
<li><b><a class="el" href="namespace_f_s_m.html">FSM</a></b>: Implement a finite state machine that simulates the investigation using smach. It has four clients that it uses to interact with other nodes. More information about the behavior of this node will be provided in the State Diagram section of the README.</li>
<li><b><a class="el" href="namespaceturtle__controller.html">turtle_controller</a></b>: This node provides two services to command the turtlebot which simulates the investigator in the environment:<ul>
<li>move_turtle_service: Move the turtle to the room you want.</li>
<li>search_hint_service: Spin the turtle a random time to simulate searching for clues in a room.</li>
</ul>
</li>
<li><b>turtlesim_node</b>: Standard node of ros.</li>
</ul>
<p><img src="/images/component.PNG?raw=true" alt="Alt text" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md4"></a>
State Diagram</h2>
<p>In the diagram below you can see all the states of the finite state machine implemented in the node "FSM" thanks to smach.</p>
<ul>
<li><b>EXPLORE</b>: In this state, the investigator moves to a random room to look for hints</li>
<li><b>SEARCH_HINTS</b>: The investigator looks for a hint, once it is found if this ends the hypothesis and if the hypothesis is valid (complete and consistent) then it goes to the TRY_HYPOTHESIS state otherwise it goes back to the EXPLORE state. The cycle continues until a valid hypothesis is found.</li>
<li><b>TRY_HYPOTHESIS</b>: The valid hypothesis found is tested, if it is correct the game ends, if wrong it returns to the EXPLORE state.</li>
<li><b>Case solved</b>: Congratulation! You found the solution!</li>
</ul>
<p><img src="/images/state.PNG?raw=true" alt="Alt text" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md5"></a>
Temporal Diagram</h2>
<p>In the diagram below you can see the behavior of the code over time.</p>
<p>1) "update_ontology" is executed. 2) Once the ontology is ready (loaded and updated) the Oracle node generates a finite set of random hypotheses: 3 valid, 3 incomplete and 3 inconsistent. From the set of complete hypotheses it will choose a solution. 3) Now that all the services are ready also "FSM" can start and with it the investigation, which will end once the state machine has managed to find the hypothesis that "oracle" has chosen as the solution.</p>
<p><img src="/images/temporal.PNG?raw=true" alt="Alt text" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md6"></a>
RQT Graph</h2>
<p>Graph generated by: </p><div class="fragment"><div class="line">rosrun rqt_graph rqt_graph</div>
</div><!-- fragment --><p>Highlight all active nodes and subscriptions to related topics.</p>
<p><img src="/images/rqt_graph.jpeg?raw=true" alt="Alt text" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Cluedo Map</h2>
<p>This image represents the cluedo map superimposed on the world of turtlesim. Unfortunately, there is no way with turtlesim to load an image in the background so the turtle moves in the rooms highlighted in this image however while the code runs the background of the map will remain blue without making explicit the room in which the turtle has just entered . To remedy this problem just read from the terminal, every time the investigator (the turtle) enters a room, the room in which she entered is written. Another solution is to keep this map within reach and see where the turtle is moving by making the comparison.</p>
<p><img src="/images/turtle_map.PNG?raw=true" alt="Alt text" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md8"></a>
List of msgs, srvs and rosparameters</h2>
<h3><a class="anchor" id="autotoc_md9"></a>
msgs</h3>
<ul>
<li><b>Twist</b>: to publish the speeds and control the turtle</li>
<li><b>Pose</b>: to subscribe and know the current position of the turtle </li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
srvs</h3>
<ul>
<li><b>armor_interface_srv</b>: to interact with the armor node and the ontology</li>
<li><b>hint_generator</b>: to request a hint from the oracle</li>
<li><b>try_hypothesis</b>: to check if the hypothesis is correct</li>
<li><b>move_service</b>: to move the turtle in rooms</li>
<li><b>search_hint_service</b>: to move the turtle in a way that simulates searching for hints in a room </li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
rosparameters</h3>
<ul>
<li><b>current_ID_hypothesis</b>: it gives you the ID of the current hypothesis</li>
<li><b>current_murderer_hypothesis</b>: it gives you the murderers (if plural clearly the hypothesis is not valid) of the current hypothesis</li>
<li><b>current_murder_weapon_hypothesis</b>: it gives you the murder weapons (if plural clearly the hypothesis is not valid) of the current hypothesis</li>
<li><b>current_murder_place_hypothesis</b>: it gives you the murder places (if plural clearly the hypothesis is not valid) of the current hypothesis</li>
<li><b>source1</b>: it gives you the first source of informations (PERSON)</li>
<li><b>source2</b>: it gives you the second source of informations (WEAPON)</li>
<li><b>source3</b>: it gives you the third source of informations (PLACE)</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Installation and running procedure</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Installation</h2>
<p>The installation is straightforward, just clone this repository to your ros workspace and do the catkin_make: </p><div class="fragment"><div class="line">git clone https://github.com/LorenzoCausa/exproblab_ass1</div>
</div><!-- fragment --><div class="fragment"><div class="line">catkin_make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Requirements</h2>
<p>To use this code some external packages are needed:</p><ul>
<li>armor</li>
<li>smach</li>
<li>turtlesim</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Put Correct Paths</h2>
<p>Before you can run the code it is necessary to enter the correct paths for the cluedo_ontology and for where you want to save the finished ontology with all the hypotheses and the solution loaded.</p>
<p>Go in "update_ontology.py" and put the path in which there is your cluedo_ontology in the global variable "path_ontology"</p>
<p>Go in "FSM.py" and put the path in which you want to save your solution_ontology in the global variable "path_save_ontology"</p>
<p><b>Note</b>: If you use the docker that was provided to us the paths are already written correctly.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Running procedure</h2>
<p>Just use the launcher: </p><div class="fragment"><div class="line">roslaunch exproblab_ass1 cluedo.launch </div>
</div><!-- fragment --><p>If you prefer you can also run a node at a time. In this case it is good to run them in this order: 1) armor 2) turtlesim_node 3) <a class="el" href="namespaceturtle__controller.html">turtle_controller</a> 4) <a class="el" href="namespaceupdate__ontology.html">update_ontology</a> 5) wait that <a class="el" href="namespaceupdate__ontology.html">update_ontology</a> finish 6) oracle 7) <a class="el" href="namespace_f_s_m.html">FSM</a></p>
<p><b>Note</b>: smach_viewer is optional and it can be run in any moment</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Behavior</h1>
<p>1) The investigator (the turtle) moves into a random room. 2) Look for hints in the room (turn on itself) 3) If with the last hint found concludes a valid hypothesis then it passes to 4. otherwise it restarts from 1. 4) Go to the Cluedo Room and test his hypothesis. If it is correct the case is solved, on the contrary it goes back to 1.</p>
<p><b>Note</b>: This cycle continues until the case is solved, however the execution is never too long as each time a hypothesis is tested it is removed from the finite list of possible hypotheses.</p>
<p><img src="/images/my_turtle_gif.gif?raw=true" alt="Alt Text" class="inline"/></p>
<p>In the figure below you can also see all the windows of interest of the system:</p><ul>
<li>the terminal</li>
<li>the turtlesim_node node</li>
<li>the smach_viewer node</li>
</ul>
<p><b>Note</b>: It was not possible to make the GIF with all the windows because the reduced resolution made the writings unreadable.</p>
<p><img src="/images/screenshot.PNG?raw=true" alt="Alt Text" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md18"></a>
Video demo</h1>
<p>You can take a look at the complete video demo of the project from here:</p>
<p><a href="https://drive.google.com/file/d/16Gz2Lt-EQ11GA9QHAHYPvvqo3uU54BXt/view?usp=sharing">Video demo here</a></p>
<h1><a class="anchor" id="autotoc_md19"></a>
Working hypothesis and environment</h1>
<p>The system is designed for maximum flexibility and modularity. With very few modifications, for example, both ontology and simulation can be changed.To avoid that the code lasts too long, it has been made so that every time a hypothesis is made, it is eliminated from the set of possible hypotheses. This is done also to simulate an intelligent investigator who does not repeat the same hypotheses. In the current code, a set of 9 randomly generated possible hypotheses is initialized: 3 valid, 3 incomplete, 3 inconsistent. The number of hypotheses can be easily expanded. In an earlier version of the code, the hypotheses were generated in a completely random way (not from a finite starting set) to better simulate the cluedo's investigation. With this version, however, the code ran for a very long time so to make it testable and debuggable the finite set of hypotheses was implemented.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
System’s features</h1>
<ul>
<li>Elimination of already tried hypotheses.</li>
<li>Simulated motion in the environment with turtlesim.</li>
<li>Modularity and flexibility.</li>
<li>Random-based generation of hints and the validation of hypothesis through armor.</li>
<li>Saving the ontology with the history of all the hypotheses made and the solution.</li>
</ul>
<p>Another feature of the system is the ability to retrieve information about the investigation while the code is running.</p>
<p>With: </p><div class="fragment"><div class="line">rosparam get /current_ID_hypothesis </div>
</div><!-- fragment --><p>you can get the ID of the hypothesis that the investigator is currently making:</p><ul>
<li>HP0, HP1, HP2 are valid hyotheses.</li>
<li>HP3, HP4, HP5 are incomplete hypotheses.</li>
<li>HP6, HP7, HP8 are inconsistent hypotheses.</li>
</ul>
<p>Instead with: </p><div class="fragment"><div class="line">rosparam get /current_murderer_hypothesis </div>
<div class="line"> </div>
<div class="line">rosparam get /current_murder_weapon_hypothesis</div>
<div class="line"> </div>
<div class="line">rosparam get /current_murder_place_hypothesis</div>
</div><!-- fragment --><p>you can get the murderer, the murder weapon and the crime scene of the hypothesis that the investigator is currently making, in case of invalid hypotheses these could also be multiple.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Improvements</h1>
<p>Possible improvements for the system are:</p><ul>
<li>Simulation in a more precise environment: a map with walls and rooms to better emulate the Cluedo game</li>
<li>"intelligent" investigator who manages to immediately discard wrong hypotheses: now he has to collect the whole hypothesis before being able to ask armor if it is valid, an important improvement could be to make it immediately discard a hypothesis as soon as it has a double field (two who or two what or two where).</li>
<li>Generation of totally random hypotheses. At the moment they are pseudorandom (from a predetermined finite set) to limit the execution time of the system. Note that if we had the "intelligent" investigator of the previous point we could generate random hypotheses and still maintain a not too long execution time.</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
Documentation</h1>
<p>All the doxygen documentation is in the Doc folder or you can access it by clicking here: <a href="https://lorenzocausa.github.io/exproblab_ass1/">click Here!</a></p>
<h1><a class="anchor" id="autotoc_md23"></a>
Author and contacts</h1>
<p>The system was developed entirely by me, below my credentials and contacts:</p>
<p><b>Lorenzo Causa, 4519089</b></p>
<p><b>mail</b>: <a href="#" onclick="location.href='mai'+'lto:'+'lor'+'en'+'zo.'+'ca'+'usa'+'@l'+'ibe'+'ro'+'.it'; return false;">loren<span style="display: none;">.nosp@m.</span>zo.c<span style="display: none;">.nosp@m.</span>ausa@<span style="display: none;">.nosp@m.</span>libe<span style="display: none;">.nosp@m.</span>ro.it</a></p>
<p><b>phone number</b>: 3247427182 <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
